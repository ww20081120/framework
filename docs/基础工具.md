### ç®€ä»‹

å®šä¹‰å…¬ç”¨çš„å¸¸é‡ã€å·¥å…·ç±» é‡‡ç”¨äº†spring-bootæ–¹å¼å¯åŠ¨ï¼Œ å¯åŠ¨ç±»ä¸ºApplicationï¼Œ ä¹Ÿå¯ä»¥æ”¯æŒwebæ–¹å¼å¯åŠ¨

### å¼‚å¸¸çš„å®šä¹‰

å¼‚å¸¸çš„é¡¶çº§APIæ˜¯FrameworkExceptionï¼Œ è¯¥ç±»ç»§æ‰¿äº†RuntimeExceptionï¼Œå»ºè®®é¡¹ç›®é‡Œé¢çš„å¼‚å¸¸éƒ½åœ¨æœ€å¤–å±‚è¿›è¡Œç»Ÿä¸€å¤„ç†ã€‚

å¸¸è§çš„å¼‚å¸¸æœ‰ï¼š

* UtilException å·¥å…·ç±»å¼‚å¸¸
* ServiceException ä¸šåŠ¡æœåŠ¡å¼‚å¸¸
* AssertException æ–­è¨€é”™è¯¯
* DaoException æ•°æ®åº“å¼‚å¸¸
* InitializationException åˆå§‹åŒ–å¯åŠ¨å¼‚å¸¸

å¦å¤–æ¯ä¸ªå¼‚å¸¸éƒ½éœ€è¦å®šä¹‰é”™è¯¯ç ï¼Œ ç³»ç»Ÿæä¾›çš„é”™è¯¯ç åœ¨com.hbasesoft.framework.common.ErrorCodeDefï¼Œ æ¡†æ¶çš„é”™è¯¯ç åœ¨5ä½ä¹‹å†…ï¼Œ æˆåŠŸçš„é”™è¯¯ç 4ä½ä»¥å†…ï¼Œé”™è¯¯çš„åœ¨10000ï½99999ä¹‹é—´ã€‚ é¡¹ç›®çš„é”™è¯¯ç éœ€è¦å¤§äº6ä½æ•°å­—ã€‚

é”™è¯¯æ–‡ä»¶çš„æè¿°åœ¨errorMessage.propertiesä¸­ç»´æŠ¤ï¼Œ å¦‚æœæƒ³å®šä¹‰è‡ªå·±çš„é¡¹ç›®çš„é”™è¯¯æè¿°ï¼Œå¯ä»¥åœ¨application.ymlä¸­ extend.errorMessage.files æ‰©å¼ é…ç½®ï¼Œå¤šä¸ªç”¨è‹±æ–‡é€—å·åˆ†éš”ã€‚

```
extend:
  errorMessage:
    files: errorMessage_msg.properties
```

### èµ„æºæ–‡ä»¶è·å–

èµ„æºæ–‡ä»¶æ”¯æŒä½¿ç”¨propertieså’Œymlä¸¤ç§æ–¹å¼è¿›è¡Œé…ç½®ï¼Œä¸¤ç§éƒ½å†™åªä»ymlä¸­è¯»å–ã€‚ application.ymlæ–‡ä»¶ä¸­é…ç½®çš„å†…å®¹å¯ä»¥ä½¿ç”¨com.hbasesoft.framework.common.utils.PropertyHolderä¸­çš„æ–¹æ³•æ¥è·å–

> PropertyHolderTest.java


```
@Test
public void getProperty() {
    String a = PropertyHolder.getProperty("test.str.str2");
    Assert.equals(a, "bcd", ErrorCodeDef.SYSTEM_ERROR_10001);

    a = PropertyHolder.getProperty("test.str.none", "abcdefg");
    Assert.equals(a, "abcdefg", ErrorCodeDef.SYSTEM_ERROR_10001);

    a = PropertyHolder.getProperty("test.int.int2");
    Assert.equals(a, "-1", ErrorCodeDef.SYSTEM_ERROR_10001);

    a = PropertyHolder.getProperty("test.long.long2");
    Assert.equals(a, "3000", ErrorCodeDef.SYSTEM_ERROR_10001);

    a = PropertyHolder.getProperty("test.bool.bool2");
    Assert.equals(a, "false", ErrorCodeDef.SYSTEM_ERROR_10001);
}

```

é¢å¤–æ‰©å±•çš„é…ç½®æ–‡ä»¶ï¼Œå¯ä»¥åœ¨application.ymlä¸­é€šè¿‡extend.property.files æ¥æ‰©å±•ï¼Œå¤šä¸ªç”¨è‹±æ–‡é€—å·åˆ†éš”ï¼Œä»£ç ä¸­è·å–åŒapplication.ymlä¸€æ ·

> application.yml

```
project:
  name: demo

test:
  str:
    str1: abc
    str2: bcd
  int:
    int1: 1
    int2: -1
  long:
    long1: 1000
    long2: 3000
  bool:
    bool1: true
    bool2: false
    
extend:
  property:
    files: ext01.properties, ext02.yml
  errorMessage:
    files: ext_errorMessage.properties
```

### é¡¹ç›®å¯åŠ¨æ—¶ç›‘å¬å·¥å…·

é¡¹ç›®ä¸­ç»å¸¸èƒ½é‡åˆ°å¯åŠ¨æ—¶å°±éœ€è¦åŠ è½½xxxåŠŸèƒ½çš„åœºæ™¯ï¼Œä¾‹å¦‚é¡¹ç›®å¯åŠ¨æ—¶éœ€è¦æ£€æŸ¥æ•°æ®åº“è¡¨æœ‰æ²¡æœ‰åˆ›å»ºï¼Œæ²¡æœ‰åˆ›å»ºåˆ™éœ€è¦åˆ›å»ºç›¸åº”çš„æ•°æ®ã€‚ Springé»˜è®¤å·²ç»æ”¯æŒäº†è¿™ç§åŠ è½½æ–¹å¼ï¼Œä½†æœ‰äº›åœºæ™¯æˆ‘ä»¬å¯èƒ½éœ€è¦åœ¨Springå®¹å™¨åŠ è½½ä¹‹å‰å¯åŠ¨ï¼Œæˆ‘ä»¬æä¾›äº†com.hbasesoft.framework.common.StartupListeneræ¥å£æ¥æ”¯æ’‘è¿™ç§åœºæ™¯

> StartupListener.java

```
public interface StartupListener {

    // å®šä¹‰å¤šä¸ªListenerä¹‹é—´çš„å…ˆåé¡ºåº
    default LoadOrder getOrder() {
        return LoadOrder.LAST;
    }

    // Spring å®¹å™¨åŠ è½½ä¹‹å‰
    default void init() {
    }

    // Spring å®¹å™¨åŠ è½½å®Œæˆä¹‹å
    default void complete(ApplicationContext context) {
    }

    // é¡¹ç›®é”€æ¯å‰
    default void destory() {
    }

    enum LoadOrder {
        FIRST, MIDDLE, LAST
    }

}
```

å¦‚ä½•ä½¿ç”¨ï¼Ÿ

1. ç¼–å†™ä¸šåŠ¡ä»£ç ç»§æ‰¿ StartupListener
2. åœ¨é¡¹ç›®çš„src/main/resources/META-INF/servicesä¸­éœ€è¦æ–°å»ºä¸€ä¸ªcom.hbasesoft.framework.common.StartupListeneræ–‡ä»¶ï¼Œé‡Œé¢çš„å†…å®¹æ˜¯å…·ä½“çš„å®ç°ç±»çš„å…¨ç§°ï¼Œå¤šä¸ªå®ç°ç±»éœ€è¦æ¢è¡Œ

### æ–­è¨€

æ–­è¨€ä½¿ç”¨com.hbasesoft.framework.common.utils.Assertå·¥å…·ç±»

> AssertTest.java

```
@Test
public void notNull() {
    Object obj = new Object();
    Assert.notNull(obj, ErrorCodeDef.SYSTEM_ERROR_10001);
    System.out.println("obj ä¸æ˜¯null");
}

@Test
public void isNull() {
    Object obj = null;
    Assert.isNull(obj, ErrorCodeDef.SYSTEM_ERROR_10001);
    System.out.println("obj æ˜¯nullå¯¹è±¡");
}

```

### æ—¥å¿—å·¥å…·

æ¡†æ¶æä¾›äº†ä¸¤ç§æ–¹å¼æ‰“å°æ—¥å¿—

1. åœ¨é¡¹ç›®ä¸­å®ä¾‹åŒ–com.hbasesoft.framework.common.utils.logger.Loggerç±»ï¼Œé€‚ç”¨äºéœ€è¦å°†æ—¥å¿—æ‰“å°åˆ°å›ºå®šæ–‡ä»¶ä¸­çš„åœºæ™¯ã€‚
2. å¦å¤–æä¾›äº†ä¸€ä¸ªå·¥å…·ç±»com.hbasesoft.framework.common.utils.logger.LoggerUtilå¯ä»¥æ–¹ä¾¿çš„ç›´æ¥æ‰“å°æ—¥å¿—


### æ—¥æœŸå¤„ç†

æä¾›äº†åœºæ™¯æ—¥æœŸæ ¼å¼è½¬åŒ–çš„æ–¹æ³•ï¼Œcom.hbasesoft.framework.common.utils.date.DateUtil

> DateUtilTest.java

```
 @Test
    public void string2Date() {
        long t1 = NUM_A;
        long t2 = NUM_B;
        long t3 = NUM_C;
        String d8 = "20180912";
        Date date = DateUtil.string2Date(d8);
        Assert.isTrue(date.getTime() == t1, ErrorCodeDef.SYSTEM_ERROR_10001);

        String d11 = "2018å¹´09æœˆ12æ—¥";
        date = DateUtil.string2Date(d11);
        Assert.isTrue(date.getTime() == t1, ErrorCodeDef.SYSTEM_ERROR_10001);

        String d10 = "2018-09-12";
        date = DateUtil.string2Date(d10);
        Assert.isTrue(date.getTime() == t1, ErrorCodeDef.SYSTEM_ERROR_10001);

        String d102 = "2018/09/12";
        date = DateUtil.string2Date(d102);
        Assert.isTrue(date.getTime() == t1, ErrorCodeDef.SYSTEM_ERROR_10001);

        String d14 = "20180912105355";
        date = DateUtil.string2Date(d14);
        Assert.isTrue(date.getTime() == t2, ErrorCodeDef.SYSTEM_ERROR_10001);

        String d17 = "20180912105355123";
        date = DateUtil.string2Date(d17);
        Assert.isTrue(date.getTime() == t3, ErrorCodeDef.SYSTEM_ERROR_10001);

        String d19 = "2018-09-12 10:53:55";
        date = DateUtil.string2Date(d19);
        Assert.isTrue(date.getTime() == t2, ErrorCodeDef.SYSTEM_ERROR_10001);

        String d192 = "2018/09/12 10:53:55";
        date = DateUtil.string2Date(d192);
        Assert.isTrue(date.getTime() == t2, ErrorCodeDef.SYSTEM_ERROR_10001);

        String d21 = "2018å¹´09æœˆ12æ—¥ 10æ—¶53åˆ†55ç§’";
        date = DateUtil.string2Date(d21);
        Assert.isTrue(date.getTime() == t2, ErrorCodeDef.SYSTEM_ERROR_10001);

        String d23 = "2018-09-12 10:53:55.123";
        date = DateUtil.string2Date(d23);
        Assert.isTrue(date.getTime() == t3, ErrorCodeDef.SYSTEM_ERROR_10001);

        String d232 = "2018/09/12 10:53:55.123";
        date = DateUtil.string2Date(d232);
        Assert.isTrue(date.getTime() == t3, ErrorCodeDef.SYSTEM_ERROR_10001);

        String str = "18å¹´9æœˆ12å·10ç‚¹53åˆ†55ç§’";
        date = DateUtil.string2Date(str, "yyå¹´Mæœˆddå·hhç‚¹mmåˆ†ssç§’");
        Assert.isTrue(date.getTime() == t2, ErrorCodeDef.SYSTEM_ERROR_10001);
    }

    @Test
    public void date2String() {
        Date date = new Date(NUM_C);
        String d8 = DateUtil.date2String(date, DateConstants.DATE_FORMAT_8);
        Assert.equals(d8, "20180912", ErrorCodeDef.SYSTEM_ERROR_10001);

        String d11 = DateUtil.date2String(date, DateConstants.DATE_FORMAT_11);
        Assert.equals(d11, "2018å¹´09æœˆ12æ—¥", ErrorCodeDef.SYSTEM_ERROR_10001);

        String d10 = DateUtil.date2String(date, DateConstants.DATE_FORMAT_10);
        Assert.equals(d10, "2018-09-12", ErrorCodeDef.SYSTEM_ERROR_10001);

        String d102 = DateUtil.date2String(date, DateConstants.DATE_FORMAT_10_2);
        Assert.equals(d102, "2018/09/12", ErrorCodeDef.SYSTEM_ERROR_10001);

        String d14 = DateUtil.date2String(date, DateConstants.DATETIME_FORMAT_14);
        Assert.equals(d14, "20180912105355", ErrorCodeDef.SYSTEM_ERROR_10001);

        String d17 = DateUtil.date2String(date, DateConstants.DATETIME_FORMAT_17);
        Assert.equals(d17, "20180912105355123", ErrorCodeDef.SYSTEM_ERROR_10001);

        String d19 = DateUtil.date2String(date);
        Assert.equals(d19, "2018-09-12 10:53:55", ErrorCodeDef.SYSTEM_ERROR_10001);

        String d192 = DateUtil.date2String(date, DateConstants.DATETIME_FORMAT_19_2);
        Assert.equals(d192, "2018/09/12 10:53:55", ErrorCodeDef.SYSTEM_ERROR_10001);

        String d21 = DateUtil.date2String(date, DateConstants.DATETIME_FORMAT_21);
        Assert.equals(d21, "2018å¹´09æœˆ12æ—¥ 10æ—¶53åˆ†55ç§’", ErrorCodeDef.SYSTEM_ERROR_10001);

        String d23 = DateUtil.date2String(date, DateConstants.DATETIME_FORMAT_23);
        Assert.equals(d23, "2018-09-12 10:53:55.123", ErrorCodeDef.SYSTEM_ERROR_10001);

        String d232 = DateUtil.date2String(date, DateConstants.DATETIME_FORMAT_23_2);
        Assert.equals(d232, "2018/09/12 10:53:55.123", ErrorCodeDef.SYSTEM_ERROR_10001);

        String str = DateUtil.date2String(date, "yyå¹´Mæœˆddå·hhç‚¹mmåˆ†ssç§’");
        Assert.equals(str, "18å¹´9æœˆ12å·10ç‚¹53åˆ†55ç§’", ErrorCodeDef.SYSTEM_ERROR_10001);
    }
```

### å¸¸ç”¨å·¥å…·

æä¾›è·å–éšæœºæ•°ã€transIdã€æ¯”è¾ƒç­‰ç­‰å¸¸è§çš„æ–¹æ³•  com.hbasesoft.framework.common.utils.CommonUtil

> CommonUtilTest.java

```
@Test
public void getTransactionID() {
    String str1 = CommonUtil.getTransactionID();
    String str2 = CommonUtil.getTransactionID();
    Assert.notEquals(str1, str2, ErrorCodeDef.SYSTEM_ERROR_10001);
    System.out.println("ç”Ÿæˆäº†ä¸¤ä¸ªä¸ä¸€æ ·çš„ä¸²ç ");
}
```

### æ–‡ä»¶æµ

æä¾›äº†æ–‡ä»¶è¯»å–ã€æµè½¬åŒ–ã€æ–‡ä»¶æ‹·è´ç­‰æ–¹æ³• com.hbasesoft.framework.common.utils.io.IOUtil

### æ¨¡ç‰ˆå¼•æ“

æä¾›äº†Javascriptã€Velocityã€OGNLè¡¨è¾¾å¼çš„è§£ææ–¹æ³• 

> VelocityParseFactoryTest.java

```
@Test
public void parse() {
    Bean bean = new Bean("å¼ ä¸‰", NUM_18);
    Map<String, Object> params = new HashMap<>();
    params.put("b", bean);

    String template = "ä½ å¥½ï¼Œæˆ‘çš„åå­—å«${b.name}";
    String str = VelocityParseFactory.parse("template01", template, params);
    Assert.equals(str, "ä½ å¥½ï¼Œæˆ‘çš„åå­—å«å¼ ä¸‰", ErrorCodeDef.SYSTEM_ERROR_10001);
}
```

> JavaScriptUtilTest.java

```
@Test
public void eval() {
    String script = "1+1";
    Double result = Double.valueOf(CommonUtil.getString(JavaScriptUtil.eval(script, null)));
    Assert.isTrue(result - 2 == 0, ErrorCodeDef.SYSTEM_ERROR_10001);

    Bean bean = new Bean("å¼ ä¸‰", NUM_18);
    Map<String, Object> params = new HashMap<>();
    params.put("b", bean);

    script = "b.getAge() + 2";
    result = Double.valueOf(CommonUtil.getString(JavaScriptUtil.eval(script, params)));
    Assert.isTrue(result - NUM_20 == 0, ErrorCodeDef.SYSTEM_ERROR_10001);
}
```

### Httpå·¥å…·

æä¾›äº†Http Getã€Postã€ä¸‹è½½æ–‡ä»¶ç­‰æ–¹æ³•çš„å¿«é€Ÿè®¿é—® com.hbasesoft.framework.common.utils.io.HttpUtil

> HttpUtilTest.java

```
@Test
public void doGet() {
    System.out
        .println(HttpUtil.doGet("https://jintan.towngasvcc.com/?null&ticket=2ccd00830d4448668b573c803f599c0f"));
    System.out.println(HttpUtil.doGet("https://www.towngasvcc.com", "utf-8"));
}


@Test
public void doPost() {
    Map<String, String> param = new HashMap<>();
    System.out.println(HttpUtil.doPost("http://www.baidu.com", param));
}

@Test
public void doGetDowloadFile() {
    HttpUtil.doGetDowloadFile("https://timgsa.baidu.com/timg?image"
        + "&quality=80&size=b9999_10000&sec=1506669107&di=3f964616fbb30dc8e9090f3921ce6dbf"
        + "&imgtype=jpg&er=1&src=http%3A%2F%2Fimgsrc.baidu.com%2Fbaike%2Fpic%"
        + "2Fitem%2Fcb8065380cd79123ea3a4a45af345982b2b7802d.jpg", "a2.jpg");
}

```

### å¸¸ç”¨çš„æ•°æ®å¤„ç†å·¥å…·

æä¾›md5ã€base64ã€å¯†ç åŠ å¯†ã€è§£å¯†ã€å­—èŠ‚è½¬16è¿›åˆ¶å­—ç¬¦ç­‰æ–¹æ³• com.hbasesoft.framework.common.utils.security.DataUtil

> DataUtilTest.java

```
@Test
public void md5For16() {
    String str1 = "123456";
    String str2 = DataUtil.md5For16(str1);
    Assert.equals(str2, "49BA59ABBE56E057", ErrorCodeDef.SYSTEM_ERROR_10001);
}
```

### åºåˆ—åŒ–å·¥å…·

ç›®å‰é‡‡ç”¨äº†protostuff åè®®åšçš„åºåˆ—åŒ–å’Œååºåˆ—åŒ– com.hbasesoft.framework.common.utils.bean.SerializationUtil

> SerializationUtilTest.java

```
@Test
public void serial() {

    Bean bean = new Bean("hello world", NUM_18);
    byte[] bs = SerializationUtil.serial(bean);
    String hexStr = DataUtil.byte2HexStr(bs);
    Assert.equals(hexStr, "0A0B68656C6C6F20776F726C641012", ErrorCodeDef.SYSTEM_ERROR_10001);
}

@Test
public void unserial() {
    byte[] bs = DataUtil.hexStr2Byte("0A0B68656C6C6F20776F726C641012");
    Bean bean = SerializationUtil.unserial(Bean.class, bs);
    Assert.equals(bean.getName(), "hello world", ErrorCodeDef.SYSTEM_ERROR_10001);
}
```

### Xmlå¤„ç†å·¥å…·

æä¾›äº†java beanè½¬xmlã€xmlè½¬java beançš„æ–¹æ³• com.hbasesoft.framework.common.utils.xml.XmlBeanUtil

> XmlTest.java

```
@Test
public void bean2xml() {

    Student student = new Student();
    student.setAge(NUM_10);
    student.setName("å°æ˜");
    student.setRemark("å°æ˜æ˜¯ä½å¥½åŒå­¦ï¼Œ<hello>å¹´å¹´ä¸‰å¥½å­¦ç”ŸğŸ‘©â€ğŸ“");

    System.out.println(XmlBeanUtil.object2Xml(student));
}

@Test
public void xml2bean() {
    String xml = "<?xml version=\"1.0\" encoding=\"UTF-8\"?><student><name>å°æ˜</name><age>10</age><remark>"
        + "<![CDATA[å°æ˜æ˜¯ä½å¥½<abcdedf>åŒå­¦ï¼Œå¹´å¹´ä¸‰å¥½å­¦ç”ŸğŸ‘©â€ğŸ“]]></remark></student>";
    Student student = XmlBeanUtil.xml2Object(xml, Student.class);
    System.out.println(student.getAge());
    System.out.println(student.getName());
    System.out.println(student.getRemark());
}

```
